<%- include('partials/head', { title: 'Create Purchase Order | Castlerock Homes', styles: ['po-line-items.css'] }) %>
<%- include('partials/header', { pageTitle: 'Create Purchase Order' }) %>

<main class="container">
  <div class="card">
    <form id="poForm">
      <select id="supplier"></select>
      <select id="site"></select>
      <select id="location"></select>
      <select id="stage" required></select>
      <input type="date" id="poDate" required>
      <div class="field-with-toggle">
        <label for="description" style="margin: 0;">Description</label>
        <button type="button" id="toggleLineItems" class="btn btn-outline-secondary btn-sm">Add Line Items</button>
      </div>
      <textarea id="description" placeholder="Description"></textarea>

      <div id="lineItemsSection" class="line-items-section" style="display: none;">
        <table class="line-items-table">
          <thead>
            <tr>
              <th>Description</th>
              <th style="width: 90px; text-align: right;">Qty</th>
              <th style="width: 90px;">Unit</th>
              <th style="width: 120px; text-align: right;">Unit Cost</th>
              <th style="width: 120px; text-align: right;">Total</th>
              <th style="width: 60px;"></th>
            </tr>
          </thead>
          <tbody id="lineItemsBody"></tbody>
        </table>
        <div class="line-items-actions">
          <button type="button" id="addLineItem" class="btn btn-outline-secondary btn-sm">Add Line Item</button>
        </div>
        <datalist id="lineItemSuggestions"></datalist>
      </div>
      <input
        type="number"
        id="netAmount"
        placeholder="Net Value"
        step="0.01"
        min="0"
        inputmode="decimal"
      />

      <select id="vatRate">
        <option value="" disabled selected>Loading VAT rates...</option>
      </select>
      <p>VAT: <span data-currency-symbol>€</span><span id="vatAmount">0.00</span></p>
      <p><b>Total: <span data-currency-symbol>€</span><span id="totalAmount">0.00</span></b></p>
      <button class="btn btn-primary">Save PO</button>
    </form>
  </div>
</main>

<%- include('partials/footer', { scripts: ['/ui.js', 'create-po.js'], includeNavScript: true }) %>

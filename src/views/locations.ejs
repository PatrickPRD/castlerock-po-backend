<%- include('partials/head', { pageTitle: 'Locations', styles: ['admin.css'] }) %>
<%- include('partials/header', { pageTitle: 'Locations' }) %>

<main class="container">

  <div class="card" id="locationsSection">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h3 style="margin: 0;">Locations</h3>
      <div style="display: flex; gap: 0.5rem;">
        <button class="btn btn-primary" onclick="openLocationModal()">
          + Add Location
        </button>
        <button id="mergeMergeBtn" class="btn btn-outline-primary" onclick="openMergeLocationModal()" style="background: #ff9800; color: white;">
          üîÄ Merge Locations
        </button>
      </div>
    </div>

    <table class="po-table">
      <thead>
        <tr>
          <th>Location</th>
          <th>Type</th>
          <th>Site</th>
          <th style="width:160px">Actions</th>
        </tr>
      </thead>
      <tbody id="locationTable"></tbody>
    </table>
  </div>

  <div id="mergeLocationModal" class="modal" style="display:none;">
    <div class="modal-content" style="width: 500px;">
      <h2>Merge Locations</h2>
      <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">
        Select two locations. The second location will be merged into the first, and all records will be updated.
      </p>

      <div class="form-row">
        <div>
          <label>Location to Keep (Merge Into)</label>
          <select id="mergeFromLocation">
            <option value="">-- Select location --</option>
          </select>
        </div>

        <div>
          <label>Location to Merge (Remove)</label>
          <select id="mergeToLocation">
            <option value="">-- Select location --</option>
          </select>
        </div>
      </div>

      <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1.5rem 0; border-radius: 4px;">
        <strong>‚ö†Ô∏è Warning:</strong> This operation will:
        <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem;">
          <li>Update all Purchase Orders from the second location to the first</li>
          <li>Update all Location Spread Rules</li>
          <li>Permanently delete the second location</li>
          <li>This action cannot be undone</li>
        </ul>
      </div>

      <div class="form-row" style="display: flex; gap: 0.5rem; justify-content: flex-end;">
        <button class="btn btn-secondary" onclick="closeMergeLocationModal()">Cancel</button>
        <button class="btn btn-danger" id="confirmMergeBtn" onclick="confirmMergeLocations()" disabled>
          Merge Locations
        </button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Location Modal -->
  <div id="locationModal" class="modal" style="display:none;">
    <div class="modal-content" style="width: 500px;">
      <h2 id="locationModalTitle">Add Location</h2>
      <p id="locationEditNotice" class="edit-notice" style="display:none; color: #666; font-size: 0.9rem; margin-bottom: 1rem;">
        ‚ö†Ô∏è Editing existing item ‚Äî changes affect all Purchase Orders
      </p>

      <div class="form-row" style="display: flex; flex-direction: column; gap: 1rem;">
        <div>
          <label for="locationName" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Location Name *</label>
          <input id="locationName" placeholder="Enter location name" class="form-control" style="width: 100%;">
        </div>

        <div>
          <label for="locationType" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Location Type</label>
          <input id="locationType" placeholder="Enter location type" class="form-control" style="width: 100%;">
        </div>

        <div>
          <label for="siteSelect" style="display: block; margin-bottom: 0.25rem; font-weight: 500;">Site *</label>
          <select id="siteSelect" class="form-select" style="width: 100%;">
            <option value="">Select site</option>
          </select>
        </div>
      </div>

      <div class="form-row" style="display: flex; gap: 0.5rem; justify-content: flex-end; margin-top: 1.5rem;">
        <button class="btn btn-secondary" onclick="closeLocationModal()">Cancel</button>
        <button class="btn btn-primary" id="saveLocationBtn" onclick="saveLocation()">
          Add Location
        </button>
      </div>
    </div>
  </div>

</main>

<%- include('partials/footer', { scripts: ['/ui.js', 'locations.js'], includeNavScript: true }) %>

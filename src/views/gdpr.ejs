<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GDPR Privacy Notice - Castlerock Homes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link href="/theme.css" rel="stylesheet">
  <style>
    .gdpr-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    .gdpr-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 3rem 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
      text-align: center;
    }
    .gdpr-section {
      background: white;
      border-radius: 8px;
      padding: 2rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .gdpr-section h2 {
      color: #667eea;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #f0f0f0;
    }
    .gdpr-section h3 {
      color: #764ba2;
      font-size: 1.2rem;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
    }
    .gdpr-section p, .gdpr-section li {
      color: #555;
      line-height: 1.8;
    }
    .gdpr-section ul {
      margin-left: 1.5rem;
    }
    .contact-box {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 1rem 1.5rem;
      margin-top: 1rem;
    }
    .print-btn {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 1000;
      border-radius: 50px !important;
      padding: 0.75rem 1rem;
      min-width: 56px;
      min-height: 56px;
      transition: all 0.3s ease;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .print-btn:hover {
      border-radius: 50px !important;
      padding: 0.75rem 1.5rem;
      min-width: auto;
    }
    .print-btn .btn-text {
      max-width: 0;
      opacity: 0;
      overflow: hidden;
      white-space: nowrap;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    .print-btn:hover .btn-text {
      max-width: 100px;
      opacity: 1;
      margin-left: 0.25rem;
    }
    .print-btn i {
      font-size: 1.25rem;
    }
    @media print {
      .print-btn { display: none; }
      .gdpr-header { background: #667eea !important; }
    }
  </style>
</head>
<%- include('./partials/header', { showNav: true }) %>

<div class="gdpr-container">
  <div class="gdpr-header">
    <h1><i class="bi bi-shield-check me-2"></i>GDPR Privacy Notice</h1>
    <p class="mb-0">Data Protection & Privacy Rights</p>
  </div>

  <div class="gdpr-section">
    <h2>1. Introduction</h2>
    <p>
      <strong id="companyName">Castlerock Homes</strong> ("we", "us", or "our") is committed to protecting your personal data and respecting your privacy rights. This Privacy Notice explains how we collect, use, store, and protect your personal information in accordance with the General Data Protection Regulation (GDPR) (EU) 2016/679 and the Data Protection Act 2018 as implemented in Ireland.
    </p>
    <p>
      This notice applies to all personal data we process about our employees, contractors, suppliers, and other individuals in connection with our construction and property development business operations.
    </p>
  </div>

  <div class="gdpr-section">
    <h2>2. Data Controller</h2>
    <p>
      <strong id="companyName2">Castlerock Homes</strong> is the data controller responsible for your personal data. For any queries or concerns about how we handle your data, please contact us using the details provided in Section 11 of this notice.
    </p>
  </div>

  <div class="gdpr-section">
    <h2>3. Personal Data We Collect</h2>
    <p>We may collect and process the following categories of personal data:</p>
    
    <h3>3.1 Identity and Contact Information</h3>
    <ul>
      <li>Full name, date of birth, and gender</li>
      <li>Contact details (email address, phone number, postal address)</li>
      <li>PPS Number (for employment and payroll purposes)</li>
      <li>Emergency contact details</li>
    </ul>

    <h3>3.2 Employment and Financial Information</h3>
    <ul>
      <li>Employment records, job title, and work history</li>
      <li>Bank account details for payroll processing</li>
      <li>Salary, wages, and payment information</li>
      <li>Tax and National Insurance details</li>
      <li>Time and attendance records (timesheets)</li>
      <li>Leave records and entitlements</li>
    </ul>

    <h3>3.3 Health and Safety Information</h3>
    <ul>
      <li>Safe Pass certification and expiry dates</li>
      <li>Health and safety training records</li>
      <li>Accident reports and incident records</li>
      <li>Medical information relevant to workplace safety</li>
    </ul>

    <h3>3.4 Technical and System Data</h3>
    <ul>
      <li>Login credentials and access logs</li>
      <li>IP addresses and device information</li>
      <li>System usage and activity logs</li>
    </ul>
  </div>

  <div class="gdpr-section">
    <h2>4. How We Use Your Personal Data</h2>
    <p>We use your personal data for the following purposes:</p>
    
    <h3>4.1 Employment and Payroll Management</h3>
    <ul>
      <li>Processing payroll and making payments</li>
      <li>Managing employment contracts and benefits</li>
      <li>Recording attendance and leave</li>
      <li>Performance management and development</li>
    </ul>

    <h3>4.2 Legal and Regulatory Compliance</h3>
    <ul>
      <li>Complying with employment law and tax obligations</li>
      <li>Meeting health and safety regulations</li>
      <li>Maintaining Safe Pass and certification records</li>
      <li>Responding to legal claims or regulatory investigations</li>
    </ul>

    <h3>4.3 Business Operations</h3>
    <ul>
      <li>Managing purchase orders and supplier relationships</li>
      <li>Project planning and site management</li>
      <li>Financial reporting and cost tracking</li>
      <li>Audit and quality assurance</li>
    </ul>

    <h3>4.4 System Security and Administration</h3>
    <ul>
      <li>Maintaining system security and preventing fraud</li>
      <li>User access management and authentication</li>
      <li>System backup and disaster recovery</li>
    </ul>
  </div>

  <div class="gdpr-section">
    <h2>5. Legal Basis for Processing</h2>
    <p>We process your personal data under the following legal bases:</p>
    <ul>
      <li><strong>Contractual necessity:</strong> Processing is necessary to perform our employment or supplier contracts</li>
      <li><strong>Legal obligation:</strong> We must process your data to comply with employment law, tax law, and health and safety regulations</li>
      <li><strong>Legitimate interests:</strong> Processing is necessary for our legitimate business interests, such as preventing fraud and maintaining system security</li>
      <li><strong>Consent:</strong> Where you have given explicit consent for specific processing activities</li>
    </ul>
  </div>

  <div class="gdpr-section">
    <h2>6. Data Sharing and Disclosure</h2>
    <p>We may share your personal data with the following categories of recipients:</p>
    <ul>
      <li><strong>Revenue Commissioners:</strong> For tax and PAYE/PRSI purposes</li>
      <li><strong>Banks and financial institutions:</strong> For payroll processing</li>
      <li><strong>Health and Safety Authority (HSA):</strong> For compliance and incident reporting</li>
      <li><strong>Pension providers and insurers:</strong> For employee benefits administration</li>
      <li><strong>IT service providers:</strong> For system hosting, maintenance, and support</li>
      <li><strong>Professional advisors:</strong> Including legal, accounting, and audit services</li>
      <li><strong>Regulatory authorities:</strong> When required by law</li>
    </ul>
    <p>We do not sell or rent your personal data to third parties for marketing purposes.</p>
  </div>

  <div class="gdpr-section">
    <h2>7. International Data Transfers</h2>
    <p>
      Your personal data is primarily stored and processed within the European Economic Area (EEA). If we transfer your data outside the EEA, we will ensure appropriate safeguards are in place, such as:
    </p>
    <ul>
      <li>EU-approved Standard Contractual Clauses</li>
      <li>Adequacy decisions by the European Commission</li>
      <li>Binding Corporate Rules or other approved mechanisms</li>
    </ul>
  </div>

  <div class="gdpr-section">
    <h2>8. Data Retention</h2>
    <p>We retain your personal data only for as long as necessary to fulfil the purposes for which it was collected and to comply with legal obligations:</p>
    <ul>
      <li><strong>Employment records:</strong> 6 years after employment ends (as required by Irish employment law)</li>
      <li><strong>Payroll and tax records:</strong> 6 years (as required by Revenue Commissioners)</li>
      <li><strong>Health and safety records:</strong> Up to 40 years for certain types of injuries or exposure (as required by HSA)</li>
      <li><strong>Audit logs:</strong> 2 years for operational purposes</li>
      <li><strong>Purchase order records:</strong> 6 years from date of last transaction</li>
    </ul>
    <p>After the retention period expires, we will securely delete or anonymize your personal data.</p>
  </div>

  <div class="gdpr-section">
    <h2>9. Your Rights Under GDPR</h2>
    <p>You have the following rights in relation to your personal data:</p>
    
    <h3>9.1 Right of Access</h3>
    <p>You can request a copy of the personal data we hold about you.</p>

    <h3>9.2 Right to Rectification</h3>
    <p>You can request that we correct any inaccurate or incomplete personal data.</p>

    <h3>9.3 Right to Erasure ("Right to be Forgotten")</h3>
    <p>You can request deletion of your personal data in certain circumstances, subject to legal retention requirements.</p>

    <h3>9.4 Right to Restrict Processing</h3>
    <p>You can request that we limit how we use your personal data in certain situations.</p>

    <h3>9.5 Right to Data Portability</h3>
    <p>You can request a copy of your personal data in a structured, machine-readable format.</p>

    <h3>9.6 Right to Object</h3>
    <p>You can object to processing based on legitimate interests or for direct marketing purposes.</p>

    <h3>9.7 Rights Related to Automated Decision-Making</h3>
    <p>You have the right not to be subject to decisions based solely on automated processing that produce legal effects.</p>

    <div class="contact-box">
      <p class="mb-0"><strong>To exercise any of these rights, please contact us using the details in Section 11.</strong></p>
    </div>
  </div>

  <div class="gdpr-section">
    <h2>10. Data Security</h2>
    <p>
      We implement appropriate technical and organizational measures to protect your personal data against unauthorized access, alteration, disclosure, or destruction. These measures include:
    </p>
    <ul>
      <li>Encryption of data in transit and at rest</li>
      <li>Role-based access controls and authentication</li>
      <li>Regular security audits and vulnerability assessments</li>
      <li>Secure backup and disaster recovery procedures</li>
      <li>Staff training on data protection and security</li>
      <li>Incident response and breach notification procedures</li>
    </ul>
    <p>
      While we strive to protect your personal data, no method of transmission over the internet or electronic storage is 100% secure. We cannot guarantee absolute security but will notify you and the Data Protection Commission in the event of a data breach where required by law.
    </p>
  </div>

  <div class="gdpr-section">
    <h2>11. Contact Information</h2>
    <p>If you have any questions, concerns, or requests regarding this Privacy Notice or how we handle your personal data, please contact us:</p>
    <div class="contact-box">
      <p><strong id="companyName3">Castlerock Homes</strong></p>
      <p class="mb-1" id="companyEmailContainer"><i class="bi bi-envelope me-2"></i>Email: <a href="mailto:privacy@castlerockhomes.ie" id="companyEmailLink">privacy@castlerockhomes.ie</a></p>
      <p class="mb-0" id="companyPhoneContainer"><i class="bi bi-telephone me-2"></i>Phone: <span id="companyPhoneText">+353 (0)1 XXX XXXX</span></p>
    </div>
  </div>

  <div class="gdpr-section">
    <h2>12. Right to Lodge a Complaint</h2>
    <p>
      If you believe we have not handled your personal data in accordance with GDPR, you have the right to lodge a complaint with the Data Protection Commission (DPC), Ireland's supervisory authority for data protection:
    </p>
    <div class="contact-box">
      <p><strong>Data Protection Commission</strong></p>
      <p>21 Fitzwilliam Square South</p>
      <p>Dublin 2, D02 RD28</p>
      <p>Ireland</p>
      <p class="mb-1"><i class="bi bi-envelope me-2"></i>Email: <a href="mailto:info@dataprotection.ie">info@dataprotection.ie</a></p>
      <p class="mb-1"><i class="bi bi-telephone me-2"></i>Phone: +353 57 868 4800</p>
      <p class="mb-0"><i class="bi bi-globe me-2"></i>Website: <a href="https://www.dataprotection.ie" target="_blank">www.dataprotection.ie</a></p>
    </div>
  </div>

  <div class="gdpr-section">
    <h2>13. Changes to This Privacy Notice</h2>
    <p>
      We may update this Privacy Notice from time to time to reflect changes in our practices or legal requirements. We will notify you of any material changes by posting the updated notice on our system and updating the "Last Updated" date below.
    </p>
    <p class="text-muted mb-0"><strong>Last Updated:</strong> February 11, 2026</p>
  </div>

  <div class="text-center mt-4 mb-5">
    <button id="downloadBtn" onclick="downloadGDPRPDF()" class="btn btn-primary me-2">
      <i class="bi bi-file-earmark-pdf me-2"></i><span id="downloadBtnText">Download</span>
    </button>
    <button onclick="window.print()" class="btn btn-outline-primary">
      <i class="bi bi-printer me-2"></i>Print this Notice
    </button>
  </div>
</div>

<button id="floatingDownloadBtn" onclick="downloadGDPRPDF()" class="btn btn-primary btn-lg print-btn shadow" title="Download">
  <i id="floatingDownloadIcon" class="bi bi-file-earmark-pdf"></i>
  <span id="floatingDownloadText" class="btn-text">Download</span>
</button>

<script src="/nav.js"></script>
<script>
  // Fetch company details from application settings
  async function loadCompanyDetails() {
    try {
      const response = await fetch('/settings/public', {
        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
      });
      
      if (response.ok) {
        const settings = await response.json();
        const companyName = settings.company_name || 'Castlerock Homes';
        const companyEmail = settings.company_email || 'privacy@castlerockhomes.ie';
        const companyPhone = settings.company_phone || '+353 (0)1 XXX XXXX';
        
        // Update all instances of company name
        document.getElementById('companyName').textContent = companyName;
        document.getElementById('companyName2').textContent = companyName;
        document.getElementById('companyName3').textContent = companyName;
        document.title = `GDPR Privacy Notice - ${companyName}`;
        
        // Update contact information
        const emailLink = document.getElementById('companyEmailLink');
        if (emailLink && companyEmail) {
          emailLink.textContent = companyEmail;
          emailLink.href = `mailto:${companyEmail}`;
        }
        
        const phoneText = document.getElementById('companyPhoneText');
        if (phoneText && companyPhone) {
          phoneText.textContent = companyPhone;
        }
      }
    } catch (error) {
      console.error('Failed to load company details:', error);
    }
  }

  document.addEventListener('DOMContentLoaded', loadCompanyDetails);

  // Download GDPR as PDF
  async function downloadGDPRPDF() {
    const downloadBtn = document.getElementById('downloadBtn');
    const floatingBtn = document.getElementById('floatingDownloadBtn');
    const floatingIcon = document.getElementById('floatingDownloadIcon');
    const floatingText = document.getElementById('floatingDownloadText');
    
    // Store original content
    const originalBtnHTML = downloadBtn.innerHTML;
    const originalIconClass = floatingIcon.className;
    const originalFloatingHTML = floatingBtn.innerHTML;
    
    try {
      // Show spinner on main button
      downloadBtn.disabled = true;
      downloadBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Downloading...';
      
      // Show spinner on floating button
      floatingBtn.disabled = true;
      floatingBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';
      
      const response = await fetch('/pdfs/gdpr', {
        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
      });
      
      if (!response.ok) {
        throw new Error('Failed to generate PDF');
      }
      
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      
      // Extract filename from Content-Disposition header or use default
      const contentDisposition = response.headers.get('Content-Disposition');
      let filename = 'GDPR-Privacy-Notice.pdf';
      if (contentDisposition) {
        const filenameMatch = contentDisposition.match(/filename="?(.+?)"?$/i);
        if (filenameMatch) {
          filename = filenameMatch[1];
        }
      }
      
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
      document.body.removeChild(a);
      
      // Restore button state
      downloadBtn.disabled = false;
      downloadBtn.innerHTML = originalBtnHTML;
      floatingBtn.disabled = false;
      floatingBtn.innerHTML = originalFloatingHTML;
    } catch (error) {
      console.error('Error downloading PDF:', error);
      alert('Failed to download PDF. Please try again.');
      
      // Restore button state on error
      downloadBtn.disabled = false;
      downloadBtn.innerHTML = originalBtnHTML;
      floatingBtn.disabled = false;
      floatingBtn.innerHTML = originalFloatingHTML;
    }
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

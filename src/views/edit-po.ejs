<%- include('partials/head', { pageTitle: 'Edit Purchase Order', styles: ['edit-po.css', 'po-line-items.css'] }) %>
<%- include('partials/header', { pageTitle: 'Edit Purchase Order' }) %>

<main class="container">
  <div class="card">
    <form id="poForm">

      <label>PO Number</label>
      <input type="text" id="poNumber" disabled>

      <label>Supplier</label>
      <select id="supplier"></select>

      <label>Site</label>
      <select id="site"></select>

      <label>Location</label>
      <select id="location"></select>
      
      <label>Stage</label>
      <select id="stage"></select>

      <label>PO Date</label>
      <input type="date" id="poDate" required>

      <div class="field-with-toggle">
        <label for="description" style="margin: 0;">Description</label>
        <button type="button" id="toggleLineItems" class="btn btn-outline-secondary btn-sm">Add Line Items</button>
      </div>
      <textarea id="description"></textarea>

      <div id="lineItemsSection" class="line-items-section" style="display: none;">
        <table class="line-items-table">
          <thead>
            <tr>
              <th>Description</th>
              <th style="width: 90px; text-align: right;">Qty</th>
              <th style="width: 90px;">Unit</th>
              <th style="width: 120px; text-align: right;">Unit Cost</th>
              <th style="width: 120px; text-align: right;">Total</th>
              <th style="width: 60px;"></th>
            </tr>
          </thead>
          <tbody id="lineItemsBody"></tbody>
        </table>
        <div class="line-items-actions">
          <button type="button" id="addLineItem" class="btn btn-outline-secondary btn-sm">Add Line Item</button>
        </div>
        <datalist id="lineItemSuggestions"></datalist>
      </div>

      <label>Net Amount (<span data-currency-symbol>€</span>)</label>
      <input
        type="number"
        id="netAmount"
        placeholder="Net Value"
        step="0.01"
        min="0"
        inputmode="decimal"
      />

      <label>VAT Rate</label>
      <select id="vatRate">
        <option value="" disabled selected>Loading VAT rates...</option>
      </select>

      <p><strong>VAT:</strong> <span data-currency-symbol>€</span><span id="vatAmount">0.00</span></p>
      <p><strong>Total:</strong> <span data-currency-symbol>€</span><span id="totalAmount">0.00</span></p>

      <button id="saveBtn" class="btn btn-primary">Save Changes</button>

    </form>
  </div>
</main>

<%- include('partials/footer', { scripts: ['/ui.js', 'edit-po.js'], includeNavScript: true }) %>

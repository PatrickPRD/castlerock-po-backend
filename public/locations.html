<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Locations | Castlerock Homes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://castlerock-po-assets-eu.s3.eu-north-1.amazonaws.com/POTrackerAssets/favicon.ico">

  <link rel="icon" type="image/png" sizes="32x32"
        href="https://castlerock-po-assets-eu.s3.eu-north-1.amazonaws.com/POTrackerAssets/favicon-32x32.png">

  <link rel="icon" type="image/png" sizes="16x16"
        href="https://castlerock-po-assets-eu.s3.eu-north-1.amazonaws.com/POTrackerAssets/favicon-16x16.png">

  <link rel="apple-touch-icon" sizes="180x180"
        href="https://castlerock-po-assets-eu.s3.eu-north-1.amazonaws.com/POTrackerAssets/apple-touch-icon.png">

  <link rel="icon" type="image/png" sizes="192x192"
        href="https://castlerock-po-assets-eu.s3.eu-north-1.amazonaws.com/POTrackerAssets/android-chrome-192x192.png">

  <link rel="icon" type="image/png" sizes="512x512"
        href="https://castlerock-po-assets-eu.s3.eu-north-1.amazonaws.com/POTrackerAssets/android-chrome-512x512.png">

  <link rel="stylesheet" href="theme.css">
  <link rel="stylesheet" href="admin.css">
</head>
<body>

<header class="app-header">
  <div class="brand">
    <img src="assets/Logo.png" alt="Castlerock Homes">
    <span><h1>Locations</h1></span>
  </div>

  <div class="header-actions">
    <div class="dropdown">
      <button class="btn-outline" onclick="toggleActionsMenu(this, event)">Actions ‚ñæ</button>
      <div id="actionsMenu" class="dropdown-menu">
        <button onclick="createPO()">Create Purchase Order</button>
        <button onclick="location.href='suppliers.html'">Suppliers</button>
      </div>
    </div>

    <div class="dropdown" id="adminDropdown" style="display:none">
      <button class="btn-outline" onclick="toggleAdminMenu(this, event)">Admin ‚ñæ</button>
      <div id="adminMenu" class="dropdown-menu">
        <button id="adminUsersBtn" onclick="location.href='users.html'">Users</button>
        <button id="adminLocationsBtn" onclick="location.href='locations.html'">Locations</button>
        <button id="adminSitesBtn" onclick="location.href='sites.html'">Sites</button>
        <div class="divider"></div>
        <button id="adminLocationSpreadBtn" onclick="location.href='location-spread.html'">Location Spread</button>
        <button id="adminBackupBtn" onclick="location.href='backup-management.html'">Backup Management</button>
      </div>
    </div>

    <div class="dropdown" id="reportsDropdown" style="display:none">
      <button class="btn-outline" onclick="toggleReportsMenu(this, event)">Reports ‚ñæ</button>
      <div id="reportsMenu" class="dropdown-menu">
        <button onclick="location.href='location-report.html'">By Location</button>
        <button onclick="location.href='supplier-report.html'">By Supplier</button>
      </div>
    </div>

    <button class="btn-outline" onclick="logout()">Logout</button>
  </div>
</header>

<main class="container">

  <!-- =======================
       LOCATIONS
       ======================= -->
  <div class="card" id="locationsSection">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <h3 style="margin: 0;">Locations</h3>
      <button id="mergeMergeBtn" class="btn-outline" onclick="openMergeLocationModal()" style="background: #ff9800; color: white;">
        üîÄ Merge Locations
      </button>
    </div>
    <p id="locationEditNotice" class="edit-notice" style="display:none;">
      Editing existing item ‚Äî changes affect all Purchase Orders
    </p>
    <div class="form-row">
      <input id="locationName" placeholder="Location name">
      <input id="locationType" placeholder="Location type">
      <select id="siteSelect"></select>
      <button
        type="button"
        id="saveLocationBtn"
        class="btn-primary"
        onclick="saveLocation()">
        Add Location
      </button>
    </div>

    <table class="po-table">
      <thead>
        <tr>
          <th>Location</th>
          <th>Type</th>
          <th>Site</th>
          <th style="width:160px">Actions</th>
        </tr>
      </thead>
      <tbody id="locationTable"></tbody>
    </table>
  </div>

  <!-- =======================
       MERGE LOCATIONS MODAL
       ======================= -->
  <div id="mergeLocationModal" class="modal" style="display:none;">
    <div class="modal-content" style="width: 500px;">
      <h2>Merge Locations</h2>
      <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">
        Select two locations. The second location will be merged into the first, and all records will be updated.
      </p>

      <div class="form-row">
        <div>
          <label>Location to Keep (Merge Into)</label>
          <select id="mergeFromLocation">
            <option value="">-- Select location --</option>
          </select>
        </div>

        <div>
          <label>Location to Merge (Remove)</label>
          <select id="mergeToLocation">
            <option value="">-- Select location --</option>
          </select>
        </div>
      </div>

      <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1.5rem 0; border-radius: 4px;">
        <strong>‚ö†Ô∏è Warning:</strong> This operation will:
        <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem;">
          <li>Update all Purchase Orders from the second location to the first</li>
          <li>Update all Location Spread Rules</li>
          <li>Permanently delete the second location</li>
          <li>This action cannot be undone</li>
        </ul>
      </div>

      <div class="form-row">
        <button class="btn-outline" onclick="closeMergeLocationModal()">Cancel</button>
        <button class="btn-danger" id="confirmMergeBtn" onclick="confirmMergeLocations()" style="background: #f44336; color: white;" disabled>
          Merge Locations
        </button>
      </div>
    </div>
  </div>

</main>

<script src="/ui.js"></script>
<script src="admin-nav.js"></script>
<script src="locations.js"></script>

</body>
</html>
